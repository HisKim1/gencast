#!/bin/bash

# ===========================================
#  Step 0: 초기화 (tmp 디렉토리 비우기)
# ===========================================
echo "Clearing /geodata2/Gencast/tmp directory..."
rm -rf /geodata2/Gencast/tmp/*

# ===========================================
#  Step 1: 날짜 범위 설정 및 반복
# ===========================================
dates=(
     "2021-04-05"
#    "2021-12-27" "2021-12-20" "2021-12-13" "2021-12-06"
#    "2021-11-29" "2021-11-22" "2021-11-15" "2021-11-08" 
#    "2021-11-01" "2021-10-25" "2021-10-18" "2021-10-11" 
#    "2021-10-04" "2021-09-27" "2021-09-20" "2021-09-13"    
#    "2021-09-06" "2021-08-30" "2021-08-23" "2021-08-16" 

#    "2021-08-09" "2021-08-02" "2021-07-26" "2021-07-19" 
#    "2021-07-12" "2021-07-05" "2021-06-28" "2021-06-21"  
#    "2021-06-14" "2021-06-07" "2021-05-31" "2021-05-24"
#    "2021-05-17" "2021-05-10" "2021-05-03" "2021-04-26" 
#    "2021-04-19" "2021-04-12" "2021-04-05" "2021-03-29" 

#    "2021-03-22" "2021-03-15" "2021-03-08" "2021-03-01"
#    "2021-02-22" "2021-02-15" "2021-02-08" "2021-02-01"
#    "2021-01-25" "2021-01-18" "2021-01-11" "2021-01-04"
)

for i in "${dates[@]}"
do
    echo "--------------------------------------------------" >&2
    echo "--------------------------------------------------" >&2
    year="${i:0:4}"
    month="${i:5:2}"
    day="${i:8:2}"
    output_file="/geodata2/Gencast/input/2021-0.25/${i}.nc"
    echo "--------------------------------------------------"
    echo "Generating data for $i"
    echo "--------------------------------------------------"
    
    python /home/hiskim1/gencast/GenCast_input.py \
        --year 2021 \
        --month $month \
        --day $day \
        --grid "0.25/0.25" \
        --output $output_file

    if [ $? -ne 0 ]; then
        echo "Error occurred while generating data for $i" 1>&2
    fi
    
    chmod 777 /geodata2/Gencast/input/2021/${i}.nc

    rm -rf /geodata2/Gencast/tmp/*
done

echo "All data generation completed!"
